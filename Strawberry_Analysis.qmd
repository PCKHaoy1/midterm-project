---
title: "Strawberry Analysis"
author: "Ruoxi Li, Haoyi Liu"
format: html
editor: visual
---

## Data Set

The dataset contains strawberry farming data with details about conventional and organic cultivation.

## Objective

Answer the following questions about strawberries using available data.

-   Where they are grown? By whom?

-   Are they really loaded with carcinogenic poisons?

-   Are they really good for your health? Bad for your health?

-   Are organic strawberries carriers of deadly diseases?

-   When I go to the market should I buy conventional or organic strawberries?

## Data Cleaning

Install packages

```{r}
# install required packages
install.packages("knitr")
install.packages("kableExtra")
install.packages("tidyverse")
install.packages("stringr")
install.packages("ggplot2")

# loading required packages
library(knitr)  
library(kableExtra)
library(tidyverse)
library(stringr)
library(ggplot2)
library(dplyr)
library(scales)
```

Read file (cite)

```{r}
# Label for the code chunk
#| label: read data - glimpse 

# Read the CSV file "strawb_mar6.csv" into a data frame called 'strawberry'
# - 'col_names = TRUE' tells read_csv to treat the first row as column names
# - 'show_col_types = FALSE' suppresses printing of column type information
strawberry <- read_csv("strawb_mar6.csv", 
                       col_names = TRUE,
                       show_col_types = FALSE)

# Source the file "my_functions.R" to load custom functions defined in that script
source("my_functions.R")
```

```{r}
# remove columns from a data frame that contain only a single unique value
strawb <- strawberry |> drop_one_value_col()
```

Exploring Data

```{r}
#| label: explore strawb data

# assume data is a tibble
# n_show is the number of rows to show

show_unique <- function(data, nrows=10 ){
  # make a tibble items to hold the data to show
  # browser()
  a <- nrows * dim(data)[2]  # number of cells in items
  items <- rep(" ", a) # items will coerce everything to char
  dim(items) <- c(nrows ,dim(data)[2]) # shape items
  items <- as_tibble(items)
  colnames(items) <- colnames(data)
  # browser()
  for(i in 1:dim(data)[2]){

    col_items <- unique(data[,i])
    # row_ex is the number of rows needed 
    # to make the column length conformable with items
    row_ex <- nrows - dim(col_items)[1] 
    if(row_ex >= 0){
      ex_rows <- tibble(rep(" ",row_ex))
      colnames(ex_rows) <- colnames(col_items)
      col_add <- rbind2(col_items, ex_rows)
      
    } else if(row_ex < 0){
      col_add <- col_items[1:10,]
      
    }

    items[,i] <- col_add

  }
  
  return(items)
}

#test <- show_unique(strawb, 10)
```

```{r}
#|label: split strawb into census and survey pieces

strw_census <- strawb |> filter(Program == "CENSUS")

strw_survey <- strawb |> filter(Program == "SURVEY")

nrow(strawb) == (nrow(strw_census) + nrow(strw_survey))
```

```{r}
#| label: examine Census and survey tibbles
#| warning: false

# Remove columns that contain only a single unique value
s_census <- strw_census |> drop_one_value_col(prt_val = TRUE)
s_survey <- strw_survey |> drop_one_value_col(prt_val = TRUE)

# Preview up to 10 unique values per column in each data set
unique_cen <- s_census |> show_unique(nrows = 10)
unique_sur <- s_survey |> show_unique(nrows = 10)

# Drop redundant or unnecessary columns from Census and Survey data
strw_census <- s_census |> select(-`State ANSI`)

# Drop 'State ANSI', 'Week Ending', and 'Period' for clarity and relevance
strw_survey <- s_survey |> select(-`State ANSI`, -`Week Ending`, -Period)

# Clean up workspace by removing intermediate and temporary objects
rm(s_census, s_survey, strawberry, strawb, items)
```

## Question 1: Strawberry growth location

```{r}
# Combine Census and Survey data
all_strw <- bind_rows(strw_census, strw_survey)

# Count observations by State
state_all1 <- all_strw |> 
  group_by(State) |> 
  count() |> 
  arrange(desc(n))  # Sort by count

# Improved bar plot
ggplot(state_all1, aes(x = reorder(State, -n), y = n)) +
  geom_bar(stat = "identity", fill = "tomato", color = "black") +
  labs(
    title = "Strawberry Production by State",
    x = "State",
    y = "Number of Records"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold", hjust = 0.5)
  )
```

Based on the bar chart showing the number of records per state in the USDA strawberry dataset:

California is by far the leading state in strawberry production, with the highest number of records in the dataset. Florida comes in second, with a substantial number of entries as well. Other states with recorded strawberry activity include: Connecticut, Massachusetts, Maine, New Hampshire, Rhode Island, Vermont, New York.

```{r}
# Show unique values in the 'Domain' column from both datasets
unique(strw_census$Domain)
unique(strw_survey$Domain)
```

```{r}
# Count number of records per Domain in Census
strw_census |> 
  count(Domain, sort = TRUE)

# Count number of records per Domain in Survey
strw_survey |> 
  count(Domain, sort = TRUE)
```

```{r, fig.width = 10, fig.height = 6}
# Clean the Value column: remove commas and ensure numeric conversion only where possible
strw_census <- strw_census |> 
  mutate(Value = gsub(",", "", Value),           # Remove commas
         Value = as.numeric(Value))              # Convert to numeric

# Summarize by total strawberry production value by sales tier
farm_sales_value <- strw_census |>
  filter(Domain == "FARM SALES") |>
  group_by(`Domain Category`) |>
  summarise(total_value = sum(Value, na.rm = TRUE)) |>
  arrange(desc(total_value))

ggplot(farm_sales_value, aes(x = reorder(`Domain Category`, total_value), y = total_value)) +
  geom_bar(stat = "identity", fill = "darkorange", color = "black") +
  labs(title = "Strawberry Production Value by Farm Sales Tier",
       x = "Farm Sales Tier",
       y = "Total Production Value ($)") +
  scale_y_continuous(labels = label_comma()) +  # <- formats axis nicely
  coord_flip() +
  theme_minimal(base_size = 14)
```

According to USDA Census data, strawberries are primarily grown by large-scale commercial farms. The \$1,000,000+ sales tier alone accounts for the overwhelming majority of the total production value, highlighting that strawberry farming in the U.S. is dominated by high-output, industrial-scale operations.

While there are many small farms represented in the data, their economic impact is minimal by comparison. Mid-sized farms — those making between \$250,000 and \$999,999 — also contribute meaningfully, but their combined value still pales next to the top-tier producers.

## Question 2: Check for carcinogenic poisons

```{r}
rm(list=ls())
```

## Question 3: Check for strawberries' health impact

## Question 4: Check if strawberries carry diseases

## Question 5: Organic or regular strawberries
